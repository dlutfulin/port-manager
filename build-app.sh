#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π —Å–±–æ—Ä–∫–∏ Port Manager
# –°–æ–∑–¥–∞–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è Intel –∏ Apple Silicon

echo "üöÄ –°–±–æ—Ä–∫–∞ Port Manager –¥–ª—è macOS"
echo "================================="

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ node_modules
if [ ! -d "node_modules" ]; then
    echo -e "${YELLOW}üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π...${NC}"
    npm install
fi

# –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Å–±–æ—Ä–∫–∏
echo -e "${YELLOW}üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–±–æ—Ä–æ–∫...${NC}"
rm -rf dist

# –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo -e "${BLUE}üî® –°–±–æ—Ä–∫–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Intel + Apple Silicon)...${NC}"
npm run dist

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏
if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!${NC}"
    echo ""
    echo -e "${GREEN}üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:${NC}"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    if [ -f "dist/Port Manager-1.0.0-universal.dmg" ]; then
        echo -e "  üìÄ DMG: dist/Port Manager-1.0.0-universal.dmg"
        echo -e "     –†–∞–∑–º–µ—Ä: $(du -h "dist/Port Manager-1.0.0-universal.dmg" | cut -f1)"
    fi
    
    if [ -f "dist/Port Manager-1.0.0-universal-mac.zip" ]; then
        echo -e "  üì¶ ZIP: dist/Port Manager-1.0.0-universal-mac.zip"
        echo -e "     –†–∞–∑–º–µ—Ä: $(du -h "dist/Port Manager-1.0.0-universal-mac.zip" | cut -f1)"
    fi
    
    echo ""
    echo -e "${BLUE}üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ:${NC}"
    echo -e "  1. ZIP-–∞—Ä—Ö–∏–≤ –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º"
    echo -e "  2. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–∑–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å Port Manager.app –≤ –ø–∞–ø–∫—É Applications"
    echo -e "  3. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ System Settings > Privacy & Security"
    echo ""
    echo -e "${YELLOW}‚ö†Ô∏è  –í–∞–∂–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:${NC}"
    echo -e "  - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö Mac (Intel –∏ Apple Silicon)"
    echo -e "  - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç macOS 10.13 –∏ –≤—ã—à–µ"
    echo -e "  - –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ macOS –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ"
    echo -e "  - –ù—É–∂–Ω–æ –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ -> Open"
    
else
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ!${NC}"
    exit 1
fi